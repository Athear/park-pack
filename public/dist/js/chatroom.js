const chatForm=document.getElementById("chat-form"),chatMessages=document.querySelector(".chat-messages"),roomName=document.getElementById("room-name"),userList=document.getElementById("users"),socket=io(),room=location.pathname.split("/chatroom/")[1];roomName.textContent=room;async function getUserData(){try{function a(a){const b=document.createElement("div");b.classList.add("message");const c=document.createElement("p");c.classList.add("meta"),c.innerText=a.username,c.innerHTML+=`<span>${a.time}</span>`,b.appendChild(c);const d=document.createElement("p");d.classList.add("text"),d.innerText=a.text,b.appendChild(d),document.querySelector(".chat-messages").appendChild(b)}function b(a){roomName.innerText=a}function c(a){userList.innerHTML="",a.forEach(a=>{const b=document.createElement("li");b.innerText=a.username,userList.appendChild(b)})}const d=await fetch("/api/users/user_data"),e=await d.json(),f=e.name;socket.emit("joinRoom",{username:f,room}),socket.on("roomUsers",({room:a,users:d})=>{b(a),c(d)}),socket.on("history",b=>{b.forEach(b=>{a({time:new Date(b.createdAt).toLocaleTimeString(),text:b.message,username:b.user})})}),socket.on("message",b=>{a(b),chatMessages.scrollTop=chatMessages.scrollHeight}),chatForm.addEventListener("submit",a=>{a.preventDefault();let b=a.target.elements.msg.value;return b=b.trim(),!!b&&void(socket.emit("chatMessage",b),a.target.elements.msg.value="",a.target.elements.msg.focus())}),document.getElementById("leave-btn").addEventListener("click",()=>{sweetAlert.fire({title:"Are you sure you want to leave this room?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, Leave!"}).then(a=>{a.isConfirmed&&(window.location="../chat")})})}catch(a){console.log(a)}}getUserData();